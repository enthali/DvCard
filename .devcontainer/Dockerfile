# Android Development Container with Android Studio
FROM ubuntu:22.04

# Verhindere interaktive Package-Installation + English Locale
ENV DEBIAN_FRONTEND=noninteractive
ENV LANG=en_US.UTF-8
ENV LANGUAGE=en_US:en
ENV LC_ALL=en_US.UTF-8

# System-Updates und grundlegende Tools (mit Progress-Output)
RUN apt-get update && echo "üì¶ Installing system packages..." && apt-get install -y -q \
    curl \
    wget \
    unzip \
    git \
    build-essential \
    file \
    apt-transport-https \
    ca-certificates \
    gnupg \
    lsb-release \
    software-properties-common \
    locales \
    && echo "en_US.UTF-8 UTF-8" >> /etc/locale.gen \
    && locale-gen \
    && echo "‚úÖ System packages installed!" \
    && rm -rf /var/lib/apt/lists/*

# Java 21 installieren (mit Progress)
RUN echo "‚òï Installing Java 21..." && apt-get update && apt-get install -y -q openjdk-21-jdk \
    && echo "‚úÖ Java 21 installed: $(java -version 2>&1 | head -1)" \
    && rm -rf /var/lib/apt/lists/*

# Umgebungsvariablen setzen
ENV JAVA_HOME=/usr/lib/jvm/java-21-openjdk-amd64
ENV PATH=$PATH:$JAVA_HOME/bin

# Android SDK Verzeichnis
ENV ANDROID_SDK_ROOT=/android-sdk
ENV ANDROID_HOME=/android-sdk
ENV PATH=$PATH:$ANDROID_SDK_ROOT/cmdline-tools/latest/bin:$ANDROID_SDK_ROOT/platform-tools

# Android Command Line Tools installieren (mit Progress)
RUN echo "üì± Installing Android SDK..." && mkdir -p $ANDROID_SDK_ROOT/cmdline-tools \
    && cd $ANDROID_SDK_ROOT/cmdline-tools \
    && echo "‚¨áÔ∏è  Downloading Android Command Line Tools..." \
    && wget --progress=bar:force https://dl.google.com/android/repository/commandlinetools-linux-11076708_latest.zip \
    && echo "üì¶ Extracting..." \
    && unzip -q commandlinetools-linux-*_latest.zip \
    && mv cmdline-tools latest \
    && rm commandlinetools-linux-*_latest.zip \
    && echo "‚úÖ Android Command Line Tools installed!"

# Android SDK Components installieren (mit Progress)
RUN echo "üì± Installing Android SDK components..." \
    && yes | $ANDROID_SDK_ROOT/cmdline-tools/latest/bin/sdkmanager --verbose \
    "platforms;android-36" \
    "build-tools;36.0.0" \
    "platform-tools" \
    "tools" \
    && echo "‚úÖ Android SDK components installed!"

# Android Studio installieren (mit Progress)
RUN echo "üöÄ Installing Android Studio..." && cd /opt \
    && echo "‚¨áÔ∏è  Downloading Android Studio (~1.5GB)..." \
    && wget --progress=bar:force https://redirector.gvt1.com/edgedl/android/studio/ide-zips/2025.1.3.7/android-studio-2025.1.3.7-linux.tar.gz \
    && echo "üì¶ Extracting Android Studio..." \
    && tar -xzf android-studio-2025.1.3.7-linux.tar.gz \
    && rm android-studio-2025.1.3.7-linux.tar.gz \
    && ln -s /opt/android-studio/bin/studio.sh /usr/local/bin/studio \
    && echo "‚úÖ Android Studio installed!"

# GUI-Libraries f√ºr Android Studio (WSLg optimiert)
RUN echo "üñ•Ô∏è  Installing GUI libraries..." && apt-get update && apt-get install -y -q \
    libxext6 \
    libxrender1 \
    libxtst6 \
    libxi6 \
    libfreetype6 \
    fontconfig \
    libgtk-3-0 \
    libxss1 \
    libasound2 \
    && echo "‚úÖ GUI libraries installed!" \
    && rm -rf /var/lib/apt/lists/*

# WSLg Unterst√ºtzung
ENV XDG_RUNTIME_DIR=/tmp/runtime-root
RUN mkdir -p $XDG_RUNTIME_DIR && chmod 700 $XDG_RUNTIME_DIR

# Workspace Verzeichnis
WORKDIR /workspace

# Port f√ºr ADB
EXPOSE 5037

# Standard Command
CMD ["bash"]
